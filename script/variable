#!/usr/bin/env bash

# interactively build conjur variable creation command
# copyright 2015 Ryan Prior all rights reserved

# get defaults
kind_default="secret" # TODO read this from somewhere

# prompt for ID
read -e -p "ID: " id

# prompt for group
read -e -p "group: " group

# prompt for kind
read -e -p "kind: " kind

# prompt for mime-type
echo "Choose or enter a mime-type"
select mimetype in "application/json" \
                   "application/xml" \
                   "application/x-yaml" \
                   "application/x-pem-file" \
                   "other"; do
    case $mimetype in
	other ) read -e -p "mime-type: " mimetype; break;;
	* ) break;;
    esac
done

# prompt for annotations
echo "annotation:"
while IFS= read -re line; do
    annotation=$(printf '%s\n%s' "$annotation" "$line")
done

# prompt for value
echo "value:"
while IFS= read -re line; do
    value=$(printf '%s\n%s' "$value" "$line")
done

# prompt to confirm
printf '
CONFIRMATION
---
conjur variable create\
  --annotate\
  --kind=%s\
  --mime-type=%s\
  --value=%s
%s
---
' "$kind" "$mimetype" "$value" "$annotation"

while true; do
    read -e -p "Run command now? (Y/N) " correct
    case $correct in
        [Yy]* ) echo "OK"; break;; # TODO run command
        [Nn]* ) echo "quit"; exit 1;;
        *     ) echo "Enter Y or N";;
    esac
done
